<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR.js Measurement Simulation</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body {
            margin: 0;
        }

        a-scene {
            width: 100%;
            height: 100%;
        }

        .button {
            position: absolute;
            bottom: 20px;
            left: 20px;
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .button:active {
            background-color: #0056b3;
        }
    </style>
</head>

<body>
    <button class="button" id="startMeasure">Start Measurement</button>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
        <a-marker preset="hiro" id="marker">
            <a-sphere id="startPoint" radius="0.02" color="green" visible="false"></a-sphere>
            <a-sphere id="endPoint" radius="0.02" color="red" visible="false"></a-sphere>
        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        let startPoint = null;
        let endPoint = null;
        let measuring = false;

        const startMeasureButton = document.getElementById('startMeasure');
        const markerElement = document.getElementById('marker');
        const startPointEntity = document.getElementById('startPoint');
        const endPointEntity = document.getElementById('endPoint');

        startMeasureButton.addEventListener('click', () => {
            measuring = true;
            startPoint = null;
            endPoint = null;
            alert('Click on the marker to set the base point, then click again to set the top point.');
        });

        markerElement.addEventListener('click', (event) => {
            if (!measuring) return;

            const intersection = event.detail.intersection.point;

            if (!startPoint) {
                // Set the base point
                startPoint = intersection;
                startPointEntity.setAttribute('position', ${ intersection.x } ${ intersection.y } ${ intersection.z });
                startPointEntity.setAttribute('visible', 'true');
                console.log('Base point set:', startPoint);
            } else {
                // Set the end point
                endPoint = intersection;
                endPointEntity.setAttribute('position', ${ intersection.x } ${ intersection.y } ${ intersection.z });
                endPointEntity.setAttribute('visible', 'true');
                console.log('Top point set:', endPoint);

                // Calculate the distance (simplified for demonstration)
                const dx = endPoint.x - startPoint.x;
                const dy = endPoint.y - startPoint.y;
                const dz = endPoint.z - startPoint.z;
                const distance = Math.sqrt(dx * dx + dy * dy + dz * dz);

                alert('Measured distance: ' + distance.toFixed(2) + ' units');
                measuring = false; // Reset for next measurement
            }
        });
    </script>
</body>

</html>